<!DOCTYPE html>
<html>
<head>
    <title>Real-time Audio Stream with Socket.IO</title>
    <script src="https://cdn.socket.io/socket.io-3.1.3.min.js"></script>
</head>
<body>
    <h2>Real-time Audio Streaming</h2>
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        navigator.mediaDevices.getUserMedia({ audio: true, video: false }).then(function(stream) {
            var source = audioContext.createMediaStreamSource(stream);
            var processor = audioContext.createScriptProcessor(1024, 1, 1);

            source.connect(processor);
            processor.connect(audioContext.destination);

            processor.onaudioprocess = function(e) {
                var inputBuffer = e.inputBuffer.getChannelData(0);
                var bufferData = new Float32Array(inputBuffer); // 오디오 버퍼를 Float32Array로 변환
                socket.emit('audio_chunk', {data: Array.from(bufferData)}); // 서버로 전송
            };
        }).catch(function(err) {
            console.log("Error: " + err);
        });
    </script>
</body>
</html>
